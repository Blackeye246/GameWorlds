import Header from "@/components/Header";import { useEffect,useState } from "react";import { useRouter } from "next/router";import { useSession,signIn } from "next-auth/react";export default function Shop({t}){const router=useRouter();const {data:session}=useSession();const [product,setProduct]=useState(null);const [accountId,setAccountId]=useState("");const [method,setMethod]=useState("Bkash");const id=router.query.product;useEffect(()=>{if(!id) return;fetch("/api/products?id="+id).then(r=>r.json()).then(setProduct);},[id]);async function placeOrder(e){e.preventDefault();if(!session) return signIn();const res=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:id,paymentMethod:method,accountId})});const data=await res.json();if(res.ok){alert("Order placed!");location.href="/dashboard";} else {alert(data.message||"Failed");}}if(!product) return(<div><Header t={t} /><div className="max-w-3xl mx-auto p-4">Loading...</div></div>);return(<div><Header t={t}/><div className="max-w-3xl mx-auto p-4"><div className="card"><h2 className="text-2xl font-bold">{product.title}</h2><p className="text-gray-300">{product.category}</p><p className="mt-2">{t("price")}: {product.price} à§³</p><form onSubmit={placeOrder} className="mt-4 flex flex-col gap-3"><input className="input" placeholder="In-game ID / Email" value={accountId} onChange={e=>setAccountId(e.target.value)} /><label className="text-sm">{t("payment")}</label><select className="input" value={method} onChange={e=>setMethod(e.target.value)}><option>Bkash</option><option>Nagad</option><option>Rocket</option><option>Binance</option></select><button className="btn">{t("place_order")}</button></form></div></div></div>)}
